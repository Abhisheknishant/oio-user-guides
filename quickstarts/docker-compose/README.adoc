
= Open IO Quick Start with Docker-Compose
:openiosds-server-ip: 10.0.4.10
:bucket-name: quickstart
:test-filename: test.txt

== Requirements

Tested successfully with:

* Docker Engine `v19.03.5`
* Docker-Compose `v1.25.1-rc1`

== Run Example

* Start the software stack with 

[source,bash]
----
docker-compose up -d
----

[TIP]
--
All the containers of this stack are sharing the same network,
with static IP that are constant over time:

The OpenIO SDS container always has the IP `{openiosds-server-ip}` for instance.
--

* Add a new object with OpenIO CLI:

[source,bash,subs=attributes]
----
# Spawn an interactive shell in the "OpenIO" client container
docker-compose exec openio-client bash

# Create a new file on the local filesystem
echo 'Hello OpenIO!' > ./{test-filename}

# Store the file as a new object in OpenIO
openio object create MY_OIO_CONTAINER ./{test-filename} --oio-account MY_ACCOUNT --ns=OPENIO --oio-proxy={openiosds-server-ip}:6006
## Should return a file with a status "OK"
----

* Create a new S3 bucket with AWS CLI:

[source,bash,subs=attributes]
----
# Spawn an interactive shell in the "OpenIO" client container
docker-compose exec aws-client bash

# Create a new S3 bucket named "{bucket-name}"
aws --endpoint-url http://{openiosds-server-ip}:6007 --no-verify-ssl s3 mb s3://{bucket-name}
# ex: aws --endpoint-url https://external.data.openio:6007 --no-verify-ssl s3 mb s3://quickstart
## Should return "make_bucket: quickstart"

# Create a new file on the local filesystem
echo 'Hello OpenIO!' > ./{test-filename}

# Store the file in the bucket
aws --endpoint-url http://{openiosds-server-ip}:6007 --no-verify-ssl s3 cp ./{test-filename} s3://{bucket-name}/
## Should return upload: ./test.txt to s3://quickstart/test.txt
---- 
